<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0">
    <title>Clearview Notes Enhanced - Tabbed Analytics with Claude Chat</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #f7fafc;
        }
        
        body.dark-mode .container {
            background: #2d3748;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        
        body.dark-mode .login-box,
        body.dark-mode .toolbar {
            background: #374151;
        }
        
        body.dark-mode .form-input,
        body.dark-mode .field-input,
        body.dark-mode .editor {
            background: #4a5568;
            color: #f7fafc;
            border-color: #6b7280;
        }
        
        body.dark-mode .form-input:focus,
        body.dark-mode .field-input:focus,
        body.dark-mode .editor:focus {
            border-color: #818cf8;
            background: #374151;
        }
        
        body.dark-mode .stats {
            background: #374151;
            color: #d1d5db;
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.2s;
        }
        
        body.dark-mode .dark-mode-toggle {
            background: rgba(45, 55, 72, 0.9);
            color: #f7fafc;
        }
        
        .dark-mode-toggle label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
        }
        
        .dark-mode-toggle input[type="checkbox"] {
            margin: 0;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            overflow: hidden; 
            position: relative;
            transition: all 0.3s ease;
        }
        
        /* Login Overlay */
        #loginOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        body.dark-mode #loginOverlay {
            background: rgba(45, 55, 72, 0.95);
        }
        
        .login-box { 
            text-align: center; 
            padding: 40px; 
            background: #f8fafc; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            width: 100%; 
            max-width: 400px;
            border: 1px solid #e2e8f0;
        }
        
        .login-box h2 { 
            font-size: 28px; 
            margin-bottom: 10px; 
            color: #1f2937; 
            font-weight: 700;
        }
        
        body.dark-mode .login-box h2 {
            color: #f7fafc;
        }
        
        .login-subtitle {
            color: #6b7280; 
            margin-bottom: 30px; 
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        body.dark-mode .form-label {
            color: #d1d5db;
        }
        
        .form-input { 
            width: 100%; 
            padding: 12px 16px; 
            font-size: 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .login-btn { 
            width: 100%; 
            padding: 14px; 
            font-size: 16px; 
            font-weight: 600;
            cursor: pointer; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            background: #4f46e5;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }
        
        .login-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .login-error { 
            color: #dc2626; 
            background: #fef2f2;
            border: 1px solid #fecaca;
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px; 
            display: none;
            font-size: 14px;
        }

        /* Main App Header */
        .header { 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); 
            color: white; 
            padding: 20px 30px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 { 
            font-size: 24px; 
            font-weight: 600; 
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Tab Navigation */
        .tab-navigation {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            padding: 0 30px;
        }
        
        body.dark-mode .tab-navigation {
            background: #374151;
            border-color: #4b5563;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            font-size: 15px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            color: #4f46e5;
            background: rgba(79, 70, 229, 0.05);
        }
        
        .tab-button.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
            background: rgba(79, 70, 229, 0.1);
        }
        
        body.dark-mode .tab-button {
            color: #9ca3af;
        }
        
        body.dark-mode .tab-button:hover {
            color: #818cf8;
            background: rgba(129, 140, 248, 0.1);
        }
        
        body.dark-mode .tab-button.active {
            color: #818cf8;
            border-bottom-color: #818cf8;
            background: rgba(129, 140, 248, 0.15);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        
        .tab-content.active {
            display: flex;
        }

        /* Main Notes Content */
        .notes-content {
            display: flex;
            flex: 1;
        }
        
        .notes-main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .toolbar { 
            background: linear-gradient(135deg, #475569 0%, #ffffff 100%);
            border: 1px solid #64748b;
            padding: 20px 30px; 
            border-bottom: 3px solid #334155;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .toolbar-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 20px;
        }
        
        .field-label { 
            font-size: 14px; 
            font-weight: 700; 
            color: #1e293b; 
            margin-bottom: 8px; 
            display: block; 
        }
        
        .field-input { 
            width: 100%;
            padding: 10px 12px; 
            border: 2px solid #d1d5db; 
            border-radius: 6px; 
            font-size: 14px; 
            font-weight: 500;
            background: #ffffff;
            transition: all 0.2s;
        }
        
        /* Voice Recording Interface */
        .tag-input-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .tag-input-field {
            flex: 1;
        }
        
        .voice-btn {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .voice-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        
        .voice-btn.recording {
            background: #fee2e2;
            border-color: #fca5a5;
            color: #dc2626;
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        body.dark-mode .voice-btn {
            background: #4a5568;
            border-color: #6b7280;
            color: #f9fafb;
        }
        
        body.dark-mode .voice-btn:hover {
            background: #6b7280;
            border-color: #9ca3af;
        }
        
        body.dark-mode .voice-btn.recording {
            background: #7f1d1d;
            border-color: #dc2626;
            color: #fca5a5;
        }
        
        .voice-controls {
            display: none;
            margin-top: 8px;
            padding: 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }
        
        .voice-controls.active {
            display: flex;
        }
        
        body.dark-mode .voice-controls {
            background: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        
        .recording-timer {
            font-family: monospace;
            font-weight: 600;
            color: #dc2626;
        }
        
        body.dark-mode .recording-timer {
            color: #fca5a5;
        }
        
        .recording-waveform {
            flex: 1;
            height: 20px;
            background: #e5e7eb;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .waveform-bar {
            position: absolute;
            bottom: 0;
            width: 2px;
            background: #4f46e5;
            border-radius: 1px;
            transition: height 0.1s ease;
        }
        
        body.dark-mode .recording-waveform {
            background: #4b5563;
        }
        
        body.dark-mode .waveform-bar {
            background: #818cf8;
        }
        
        .voice-control-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .voice-control-btn:hover {
            background: #dc2626;
        }
        
        .voice-control-btn.pause {
            background: #f59e0b;
        }
        
        .voice-control-btn.pause:hover {
            background: #d97706;
        }
        
        .audio-playback {
            display: none;
            margin-top: 8px;
            padding: 10px 12px;
            background: #ecfdf5;
            border: 1px solid #d1fae5;
            border-radius: 8px;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }
        
        .audio-playback.active {
            display: flex;
        }
        
        body.dark-mode .audio-playback {
            background: #064e3b;
            border-color: #065f46;
            color: #d1fae5;
        }
        
        .audio-play-btn {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .audio-play-btn:hover {
            background: #059669;
        }
        
        .audio-info {
            flex: 1;
        }
        
        .audio-duration {
            font-family: monospace;
            font-weight: 600;
            color: #065f46;
        }
        
        body.dark-mode .audio-duration {
            color: #6ee7b7;
        }
        
        .audio-delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .audio-delete-btn:hover {
            background: #dc2626;
        }
        
        .button-group { 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap; 
        }
        
        .btn { 
            background: #4f46e5; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 15px; 
            font-weight: 500; 
            min-height: 44px; 
            transition: all 0.2s;
        }
        
        .btn:hover:not(:disabled) { 
            background: #4338ca; 
            transform: translateY(-1px); 
        }
        
        .btn-secondary { 
            background: #374151;
            color: white;
        }
        
        .btn-secondary:hover:not(:disabled) { 
            background: #1f2937;
        }

        /* Claude AI Chat Interface */
        .chat-container {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            padding: 0;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        body.dark-mode .chat-container {
            background: #374151;
            border-color: #4b5563;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chat-header:hover {
            background: linear-gradient(135deg, #4338ca 0%, #6d28d9 100%);
        }
        
        .chat-title {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-toggle-icon {
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .chat-toggle-icon.expanded {
            transform: rotate(180deg);
        }
        
        .chat-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .chat-content.expanded {
            max-height: 400px;
        }
        
        .chat-inner {
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .chat-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        body.dark-mode .chat-warning {
            background: #78350f;
            border-color: #f59e0b;
            color: #fbbf24;
        }
        
        .chat-suggestions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .chat-suggestion {
            background: #f3f4f6;
            color: #374151;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
        }
        
        .chat-suggestion:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        body.dark-mode .chat-suggestion {
            background: #4b5563;
            color: #d1d5db;
            border-color: #6b7280;
        }
        
        body.dark-mode .chat-suggestion:hover {
            background: #6b7280;
        }
        
        .chat-messages {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        body.dark-mode .chat-messages {
            background: #2d3748;
            border-color: #4b5563;
        }
        
        .chat-message {
            padding: 8px 12px;
            border-radius: 8px;
            max-width: 85%;
            word-wrap: break-word;
        }
        
        .chat-message.user {
            background: #ddd6fe;
            color: #5b21b6;
            margin-left: auto;
            text-align: right;
        }
        
        .chat-message.assistant {
            background: #ecfdf5;
            color: #065f46;
        }
        
        body.dark-mode .chat-message.user {
            background: #6366f1;
            color: #e0e7ff;
        }
        
        body.dark-mode .chat-message.assistant {
            background: #065f46;
            color: #d1fae5;
        }
        
        .chat-input-container {
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }
        
        .chat-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 40px;
            max-height: 80px;
            transition: all 0.2s;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        body.dark-mode .chat-input {
            background: #4a5568;
            color: #f7fafc;
            border-color: #6b7280;
        }
        
        .chat-send-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            height: 40px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .chat-send-btn:hover:not(:disabled) {
            background: #4338ca;
        }
        
        .chat-send-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .editor-container { 
            padding: 30px; 
            flex: 1;
        }
        
        .tags { 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap; 
            margin-bottom: 20px; 
        }
        
        .tag { 
            background: #ddd6fe; 
            color: #5b21b6; 
            padding: 6px 12px; 
            border-radius: 16px; 
            font-size: 12px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s;
            user-select: none;
        }
        
        .tag:hover { 
            background: #c4b5fd; 
            transform: scale(1.05);
        }
        
        .editor { 
            width: 100%; 
            min-height: 400px; 
            border: 2px solid #e2e8f0; 
            outline: none; 
            resize: vertical; 
            font-size: 16px; 
            line-height: 1.6; 
            color: #374151; 
            background: #fafbff; 
            border-radius: 8px; 
            padding: 20px; 
            font-family: inherit;
            transition: all 0.2s;
        }
        
        .editor:focus { 
            border-color: #4f46e5; 
            background: #ffffff;
        }

        .stats { 
            background: #f1f5f9; 
            padding: 15px 30px; 
            border-top: 1px solid #e2e8f0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 14px; 
            color: #64748b; 
        }
        
        .success-message { 
            background: #10b981; 
            color: white; 
            padding: 12px 20px; 
            border-radius: 8px; 
            margin: 15px 0; 
            display: none; 
            font-size: 14px;
        }
        
        .success-message.error {
            background: #ef4444;
        }

        /* Analytics Tab Content - Keeping from original */
        .analytics-dashboard {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .analytics-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .analytics-title {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        body.dark-mode .analytics-title {
            color: #f7fafc;
        }
        
        .analytics-subtitle {
            color: #6b7280;
            font-size: 16px;
        }
        
        body.dark-mode .analytics-subtitle {
            color: #9ca3af;
        }

        /* Analytics Grid Layout */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Overview Stats Cards */
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        body.dark-mode .stats-card {
            background: #374151;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        
        .stats-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .stats-icon {
            font-size: 24px;
            padding: 8px;
            border-radius: 8px;
            background: rgba(79, 70, 229, 0.1);
        }
        
        .stats-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
        }
        
        body.dark-mode .stats-card-title {
            color: #f3f4f6;
        }
        
        .stats-number {
            font-size: 36px;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 8px;
        }
        
        body.dark-mode .stats-number {
            color: #818cf8;
        }
        
        .stats-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        body.dark-mode .stats-label {
            color: #9ca3af;
        }

        /* Hot Topics Section */
        .hot-topics-card {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .hot-topics-card {
            background: #374151;
            border-color: #4b5563;
        }
        
        .hot-topics-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .hot-topics-title {
            font-size: 20px;
            font-weight: 600;
            color: #dc2626;
        }
        
        body.dark-mode .hot-topics-title {
            color: #f87171;
        }
        
        .hot-topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .hot-tag-card {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .hot-tag-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
        }
        
        .hot-tag-card.ultra-hot {
            background: linear-gradient(45deg, #dc2626, #ef4444);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        
        .hot-tag-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .hot-tag-stats {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Detailed Tag List */
        .tag-list-card {
            grid-column: 1 / -1;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .tag-list-card {
            background: #374151;
            border-color: #4b5563;
        }
        
        .tag-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .tag-list-title {
            font-size: 20px;
            font-weight: 600;
            color: #374151;
        }
        
        body.dark-mode .tag-list-title {
            color: #f3f4f6;
        }
        
        .tag-sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .sort-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            cursor: pointer;
        }
        
        body.dark-mode .sort-select {
            background: #4b5563;
            color: #f9fafb;
            border-color: #6b7280;
        }
        
        .view-tags-btn, .clear-analytics-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
            transition: all 0.2s;
        }
        
        .view-tags-btn:hover {
            background: #4b5563;
        }
        
        .clear-analytics-btn {
            background: #dc2626;
        }
        
        .clear-analytics-btn:hover {
            background: #b91c1c;
        }
        
        .export-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: #4f46e5;
        }
        
        /* Tag List Modal */
        .tag-list-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }
        
        .tag-list-modal.show {
            display: flex;
        }
        
        .tag-list-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .tag-list-content {
            background: #2d3748;
            color: #f7fafc;
        }
        
        .tag-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 15px;
        }
        
        body.dark-mode .tag-list-header {
            border-color: #4b5563;
        }
        
        .tag-list-title {
            font-size: 20px;
            font-weight: 600;
            color: #1f2937;
        }
        
        body.dark-mode .tag-list-title {
            color: #f7fafc;
        }
        
        .close-modal {
            background: #6b7280;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .close-modal:hover {
            background: #4b5563;
        }
        
        .tag-list-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .tag-item-display {
            background: #f3f4f6;
            padding: 8px 12px;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .tag-item-display {
            background: #4b5563;
            border-color: #6b7280;
            color: #f3f4f6;
        }
        
        .tag-item-name {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .tag-item-count {
            font-size: 10px;
            color: #6b7280;
        }
        
        body.dark-mode .tag-item-count {
            color: #9ca3af;
        }
        
        .tag-details-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .tag-detail-item {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        /* Heat level styling for detailed view */
        .tag-detail-item.heat-1 {
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.1) 0%, transparent 100%);
            border-left: 4px solid #22c55e;
        }
        
        .tag-detail-item.heat-2 {
            background: linear-gradient(90deg, rgba(234, 179, 8, 0.15) 0%, transparent 100%);
            border-left: 4px solid #eab308;
        }
        
        .tag-detail-item.heat-3 {
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.2) 0%, transparent 100%);
            border-left: 4px solid #f97316;
        }
        
        .tag-detail-item.heat-4 {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.25) 0%, transparent 100%);
            border-left: 4px solid #ef4444;
        }
        
        .tag-detail-item.heat-5 {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.3) 0%, transparent 100%);
            border-left: 4px solid #dc2626;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.2);
        }
        
        .tag-detail-item:hover {
            background: #e0e7ff;
            border-color: #4f46e5;
            transform: translateX(3px);
        }
        
        body.dark-mode .tag-detail-item {
            background: #4b5563;
            border-color: #6b7280;
            color: #f9fafb;
        }
        
        body.dark-mode .tag-detail-item:hover {
            background: #6366f1;
            border-color: #818cf8;
        }
        
        .tag-detail-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .tag-detail-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .tag-detail-meta {
            font-size: 12px;
            color: #6b7280;
        }
        
        body.dark-mode .tag-detail-meta {
            color: #9ca3af;
        }
        
        .tag-detail-metrics {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }
        
        .tag-metric-primary {
            font-size: 18px;
            font-weight: 700;
            color: #4f46e5;
        }
        
        body.dark-mode .tag-metric-primary {
            color: #818cf8;
        }
        
        .tag-metric-secondary {
            font-size: 11px;
            color: #6b7280;
        }
        
        body.dark-mode .tag-metric-secondary {
            color: #9ca3af;
        }
        
        .tag-indicators {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 12px;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 30px;
            color: #6b7280;
        }
        
        body.dark-mode .empty-state {
            color: #9ca3af;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .empty-text {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Browse Notes Tab Content */
        .browse-dashboard {
            padding: 30px;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .browse-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .browse-title {
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        body.dark-mode .browse-title {
            color: #f7fafc;
        }
        
        .browse-subtitle {
            color: #6b7280;
            font-size: 16px;
        }
        
        body.dark-mode .browse-subtitle {
            color: #9ca3af;
        }

        /* Browse Controls */
        .browse-controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .browse-controls {
            background: #374151;
            border-color: #4b5563;
        }
        
        .browse-search-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        .browse-search {
            width: 100%;
            padding: 12px 16px;
            padding-right: 45px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .browse-search:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        body.dark-mode .browse-search {
            background: #4a5568;
            color: #f7fafc;
            border-color: #6b7280;
        }
        
        .clear-search-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: #6b7280;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .clear-search-btn:hover {
            background: #4b5563;
        }
        
        .browse-filters {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 12px;
            align-items: center;
        }
        
        .tag-filter, .sort-filter {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            color: #374151;
            cursor: pointer;
            font-size: 14px;
        }
        
        body.dark-mode .tag-filter,
        body.dark-mode .sort-filter {
            background: #4b5563;
            color: #f9fafb;
            border-color: #6b7280;
        }
        
        .refresh-btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        
        .refresh-btn:hover {
            background: #4f46e5;
        }

        /* Browse Stats */
        .browse-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        
        body.dark-mode .stat-item {
            background: #374151;
            border-color: #4b5563;
        }
        
        .stat-number {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 4px;
        }
        
        body.dark-mode .stat-number {
            color: #818cf8;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
        }
        
        body.dark-mode .stat-label {
            color: #9ca3af;
        }

        /* Notes Grid */
        .notes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .note-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .note-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #4f46e5;
        }
        
        body.dark-mode .note-card {
            background: #374151;
            border-color: #4b5563;
        }
        
        body.dark-mode .note-card:hover {
            border-color: #818cf8;
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .note-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
            line-height: 1.3;
        }
        
        body.dark-mode .note-title {
            color: #f7fafc;
        }
        
        .note-filename {
            font-size: 12px;
            color: #6b7280;
            font-family: monospace;
        }
        
        body.dark-mode .note-filename {
            color: #9ca3af;
        }
        
        .note-actions {
            display: flex;
            gap: 6px;
        }
        
        .note-action-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #374151;
        }
        
        .note-action-btn:hover {
            background: #e5e7eb;
        }
        
        .note-action-btn.load {
            background: #ddd6fe;
            color: #5b21b6;
        }
        
        .note-action-btn.load:hover {
            background: #c4b5fd;
        }
        
        .note-action-btn.delete {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .note-action-btn.delete:hover {
            background: #fee2e2;
        }
        
        body.dark-mode .note-action-btn {
            background: #4b5563;
            color: #d1d5db;
        }
        
        body.dark-mode .note-action-btn:hover {
            background: #6b7280;
        }
        
        body.dark-mode .note-action-btn.load {
            background: #6366f1;
            color: #e0e7ff;
        }
        
        body.dark-mode .note-action-btn.load:hover {
            background: #4f46e5;
        }
        
        body.dark-mode .note-action-btn.delete {
            background: #7f1d1d;
            color: #fca5a5;
        }
        
        body.dark-mode .note-action-btn.delete:hover {
            background: #991b1b;
        }
        
        .note-preview {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        body.dark-mode .note-preview {
            color: #9ca3af;
        }
        
        .note-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .note-tag {
            background: #ddd6fe;
            color: #5b21b6;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        body.dark-mode .note-tag {
            background: #6366f1;
            color: #e0e7ff;
        }
        
        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
            padding-top: 12px;
        }
        
        body.dark-mode .note-meta {
            color: #9ca3af;
            border-color: #4b5563;
        }
        
        .note-date {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .note-stats {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .note-indicator {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .empty-library {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 30px;
            color: #6b7280;
        }
        
        body.dark-mode .empty-library {
            color: #9ca3af;
        }
        
        .empty-library .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .empty-library .empty-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .empty-library .empty-text {
            font-size: 16px;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { border-radius: 8px; }
            .header { padding: 15px 20px; flex-direction: column; gap: 10px; }
            .tab-navigation { padding: 0 20px; }
            .tab-button { padding: 12px 15px; font-size: 14px; }
            .analytics-dashboard { padding: 20px; }
            .analytics-grid { grid-template-columns: 1fr; gap: 15px; }
            .hot-topics-grid { grid-template-columns: 1fr; }
            .toolbar { padding: 15px 20px; }
            .toolbar-grid { grid-template-columns: 1fr; }
            .editor-container { padding: 20px; }
            
            /* Mobile Browse Notes */
            .browse-dashboard { padding: 20px; }
            .browse-controls { padding: 15px; }
            .browse-filters { 
                grid-template-columns: 1fr; 
                gap: 10px; 
            }
            .browse-stats { 
                grid-template-columns: repeat(3, 1fr); 
                gap: 10px; 
            }
            .stat-item { padding: 12px; }
            .notes-grid { 
                grid-template-columns: 1fr; 
                gap: 15px; 
            }
            .note-card { padding: 16px; }
            .note-header { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 8px; 
            }
            .note-actions { 
                align-self: flex-end; 
            }
        }
    </style>
</head>
<body>
    <!-- Dark Mode Toggle -->
    <div class="dark-mode-toggle">
        <label>
            <input type="checkbox" id="darkModeToggle" />
            üåô Dark Mode
        </label>
    </div>

    <div class="container">
        <!-- Login Overlay -->
        <div id="loginOverlay">
            <div class="login-box">
                <h2>üîê Clearview Notes</h2>
                <p class="login-subtitle">Enhanced with Analytics, Reminders & Note Library</p>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="usernameInput">Username</label>
                        <input type="text" id="usernameInput" class="form-input" placeholder="Enter your username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="passwordInput">Password</label>
                        <input type="password" id="passwordInput" class="form-input" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" id="loginBtn" class="login-btn">üöÄ Access Notes</button>
                    <div id="loginError" class="login-error"></div>
                </form>
            </div>
        </div>

        <!-- Main Application -->
        <div id="mainApp" style="visibility: hidden;">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1>üìù Clearview Notes Enhanced</h1>
                    <div style="font-size: 14px; opacity: 0.8; margin-top: 4px;">Analytics + Reminders + Browse v4.0</div>
                </div>
                <div class="user-info">
                    <span id="sessionInfo">Welcome!</span>
                    <button id="logoutBtn" class="logout-btn">üîì Logout</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-button active" data-tab="notes">
                    üìù Notes
                </button>
                <button class="tab-button" data-tab="analytics">
                    üìä Tag Analytics
                </button>
                <button class="tab-button" data-tab="browse">
                    üìÇ Browse Notes
                </button>
            </div>

            <!-- Notes Tab Content -->
            <div id="notesTab" class="tab-content active">
                <div class="notes-content">
                                            <!-- Main Notes Area -->
                    <div class="notes-main">
                        <div class="toolbar">
                            <div class="toolbar-grid">
                                <div>
                                    <label class="field-label" for="filename">üìÅ Filename</label>
                                    <input type="text" id="filename" class="field-input" placeholder="Enter filename...">
                                </div>
                                <div>
                                    <label class="field-label" for="tagInput">üè∑Ô∏è Add Tags (Press Enter)</label>
                                    <div class="tag-input-container">
                                        <input type="text" id="tagInput" class="field-input tag-input-field" placeholder="Type tag and press Enter">
                                        <button id="voiceBtn" class="voice-btn" title="Record voice note">üé§</button>
                                    </div>
                                    
                                    <!-- Voice Recording Controls -->
                                    <div id="voiceControls" class="voice-controls">
                                        <span class="recording-timer" id="recordingTimer">00:00</span>
                                        <div class="recording-waveform" id="recordingWaveform"></div>
                                        <button id="stopRecordingBtn" class="voice-control-btn">‚èπÔ∏è Stop</button>
                                        <button id="pauseRecordingBtn" class="voice-control-btn pause">‚è∏Ô∏è Pause</button>
                                    </div>
                                    
                                    <!-- Audio Playback -->
                                    <div id="audioPlayback" class="audio-playback">
                                        <button id="audioPlayBtn" class="audio-play-btn">‚ñ∂Ô∏è</button>
                                        <div class="audio-info">
                                            <div>üé§ Voice Note</div>
                                            <div class="audio-duration" id="audioDuration">00:00</div>
                                        </div>
                                        <button id="audioDeleteBtn" class="audio-delete-btn">üóëÔ∏è Delete</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="field-label" for="reminderInput">‚è∞ Set Reminder</label>
                                    <div class="reminder-container">
                                        <input type="datetime-local" id="reminderInput" class="field-input reminder-input">
                                        <button id="setReminderBtn" class="reminder-btn" title="Set reminder">‚è∞</button>
                                        <button id="clearReminderBtn" class="reminder-btn clear" title="Clear reminder" style="display: none;">‚úï</button>
                                    </div>
                                    
                                    <!-- Active Reminder Display -->
                                    <div id="activeReminder" class="active-reminder" style="display: none;">
                                        <div class="reminder-info">
                                            <span class="reminder-icon">‚è∞</span>
                                            <div class="reminder-details">
                                                <div class="reminder-date" id="reminderDate"></div>
                                                <div class="reminder-countdown" id="reminderCountdown"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="button-group">
                                <button class="btn btn-secondary" id="newNoteBtn">üìÑ New Note</button>
                                <button class="btn" id="saveAsBtn">üíæ Save As</button>
                                <button class="btn btn-gdrive" id="saveToGDriveBtn">üì§ Save to Google Drive</button>
                                <button class="btn btn-secondary" id="loadBtn">üìÅ Load Note</button>
                                <button class="btn btn-delete" id="deleteNoteBtn">üóëÔ∏è Delete Note</button>
                            </div>
                            
                            <div id="successMessage" class="success-message"></div>
                            <input type="file" id="fileInput" accept=".json" style="display: none;">
                        </div>
                        
                        <div class="editor-container">
                            <div id="tags" class="tags"></div>
                            <textarea id="editor" class="editor" placeholder="Start writing your thoughts here...

Just begin writing - no need to plan a title first! Let your ideas flow naturally and use tags to organize your thoughts.

üéØ Enhanced Features:
‚Ä¢ Save As - Choose your save location with modern file picker
‚Ä¢ Save to Google Drive - Direct integration with Google Drive
‚Ä¢ Tag Analytics - Only shows YOUR actual tag usage (no demo data)
‚Ä¢ View All Tags - See exactly which tags are being counted
‚Ä¢ Reset Analytics - Clear old data to start fresh
‚Ä¢ Voice Recording - Add audio notes with your text
‚Ä¢ Reminders - Set date/time reminders for important notes

üí° Keyboard Shortcuts:
‚Ä¢ Ctrl+S: Save As (choose location)
‚Ä¢ Ctrl+N: New Note  
‚Ä¢ Ctrl+L: Load Note
‚Ä¢ Shift+Ctrl+D: Delete Note

‚è∞ Reminder Tips:
‚Ä¢ Set reminders for follow-ups, meetings, or deadlines
‚Ä¢ Reminders persist even after closing the app
‚Ä¢ Get browser notifications when reminders are due
‚Ä¢ Overdue reminders will be highlighted in red

Your analytics now reflect your real usage patterns! üöÄ"></textarea>
                        </div>
                        
                        <div class="stats">
                            <div><span id="wordCount">0</span> words ‚Ä¢ <span id="charCount">0</span> characters</div>
                            <div>Last modified: <span id="lastModified">Never</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab Content -->
            <div id="analyticsTab" class="tab-content">
                <div class="analytics-dashboard">
                    <div class="analytics-header">
                        <div class="analytics-title">üìä Your Tag Analytics</div>
                        <div class="analytics-subtitle">Analytics based only on tags you've actually used</div>
                    </div>

                    <div class="analytics-grid">
                        <!-- Overview Stats -->
                        <div class="stats-card">
                            <div class="stats-card-header">
                                <div class="stats-icon">üè∑Ô∏è</div>
                                <div class="stats-card-title">Your Tags</div>
                            </div>
                            <div class="stats-number" id="totalTagsDetailed">0</div>
                            <div class="stats-label">Tags you've actually used</div>
                            <button id="viewAllTagsBtn" class="view-tags-btn">üìã View All Tags</button>
                        </div>

                        <div class="stats-card">
                            <div class="stats-card-header">
                                <div class="stats-icon">üìà</div>
                                <div class="stats-card-title">Total Usage</div>
                            </div>
                            <div class="stats-number" id="totalUsageDetailed">0</div>
                            <div class="stats-label">Times you've used tags</div>
                        </div>

                        <div class="stats-card">
                            <div class="stats-card-header">
                                <div class="stats-icon">‚≠ê</div>
                                <div class="stats-card-title">Average Use</div>
                            </div>
                            <div class="stats-number" id="averageUseDetailed">0</div>
                            <div class="stats-label">Average uses per tag</div>
                        </div>

                        <div class="stats-card">
                            <div class="stats-card-header">
                                <div class="stats-icon">üéØ</div>
                                <div class="stats-card-title">Session Tags</div>
                            </div>
                            <div class="stats-number" id="activeTagsDetailed">0</div>
                            <div class="stats-label">Tags in current note</div>
                            <button id="clearAnalyticsBtn" class="clear-analytics-btn">üóëÔ∏è Reset Analytics</button>
                        </div>

                        <!-- Hot Topics Section -->
                        <div class="hot-topics-card">
                            <div class="hot-topics-header">
                                <div style="font-size: 24px;">üî•</div>
                                <div class="hot-topics-title">Hot Topics</div>
                            </div>
                            <div id="hotTopicsDetailed" class="hot-topics-grid">
                                <div class="empty-state">
                                    <div class="empty-icon">üè∑Ô∏è</div>
                                    <div class="empty-title">No tags yet!</div>
                                    <div class="empty-text">Start adding tags to your notes to see hot topics here.</div>
                                </div>
                            </div>
                        </div>

                        <!-- Detailed Tag List -->
                        <div class="tag-list-card">
                            <div class="tag-list-header">
                                <div class="tag-list-title">üìã Detailed Tag Analysis</div>
                                <div class="tag-sort-controls">
                                    <select id="detailedSortSelect" class="sort-select">
                                        <option value="usage">By Usage</option>
                                        <option value="recent">By Recent</option>
                                        <option value="alpha">Alphabetical</option>
                                        <option value="trending">By Trend</option>
                                    </select>
                                    <button id="exportDetailedBtn" class="export-btn">üì§ Export CSV</button>
                                </div>
                            </div>
                            <div id="detailedTagList" class="tag-details-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üìä</div>
                                    <div class="empty-title">No tag data available</div>
                                    <div class="empty-text">Add some tags to your notes to see detailed analytics here.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Browse Notes Tab Content -->
            <div id="browseTab" class="tab-content">
                <div class="browse-dashboard">
                    <div class="browse-header">
                        <div class="browse-title">üìÇ My Notes Library</div>
                        <div class="browse-subtitle">Browse, search, and load your saved notes</div>
                    </div>

                    <div class="browse-controls">
                        <div class="browse-search-container">
                            <input type="text" id="browseSearch" class="browse-search" placeholder="Search notes by title, content, or tags...">
                            <button id="clearSearchBtn" class="clear-search-btn" style="display: none;">‚úï</button>
                        </div>
                        
                        <div class="browse-filters">
                            <select id="tagFilter" class="tag-filter">
                                <option value="">All Tags</option>
                            </select>
                            
                            <select id="sortFilter" class="sort-filter">
                                <option value="recent">Most Recent</option>
                                <option value="oldest">Oldest First</option>
                                <option value="title">By Title</option>
                                <option value="size">By Size</option>
                            </select>
                            
                            <button id="refreshNotesBtn" class="refresh-btn">üîÑ Refresh</button>
                        </div>
                    </div>

                    <div class="browse-stats">
                        <div class="stat-item">
                            <span class="stat-number" id="totalNotes">0</span>
                            <span class="stat-label">Total Notes</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="filteredNotes">0</span>
                            <span class="stat-label">Showing</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number" id="totalWords">0</span>
                            <span class="stat-label">Total Words</span>
                        </div>
                    </div>

                    <div class="notes-grid" id="notesGrid">
                        <div class="empty-library">
                            <div class="empty-icon">üìö</div>
                            <div class="empty-title">No notes in your library yet</div>
                            <div class="empty-text">
                                Notes you save through this app will appear here for easy browsing and loading.
                                <br><br>
                                <strong>To get started:</strong>
                                <br>1. Go to the Notes tab
                                <br>2. Write some content and add tags
                                <br>3. Use "Save As" or "Save to Google Drive"
                                <br>4. Your notes will appear here automatically
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Authentication Configuration
        const AUTH_CONFIG = {
            users: {
                'glen': 'clearview2024',
                'admin': 'notes123',
                'user': 'demo2024'
            },
            sessionTimeout: 8 * 60 * 60 * 1000 // 8 hours
        };

        let tags = [];
        let isAuthenticated = false;
        let currentUser = '';
        let tagHistory = [];
        let currentTab = 'notes';
        let currentSortMethod = 'usage';
        let currentReminder = null;
        let reminderInterval = null;
        let noteLibrary = [];
        let filteredNotes = [];
        let currentSearchTerm = '';
        let currentTagFilter = '';
        let currentSortFilter = 'recent';
        
        // Voice recording variables
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let isPaused = false;
        let recordingTimer = null;
        let recordingStartTime = 0;
        let currentAudioData = null;
        let audioElement = null;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ DOM Content Loaded - Enhanced with Claude Chat...');
            console.log('Document ready state:', document.readyState);
            
            try {
                checkAuthStatus();
                setupEventListeners();
                initializeEnhancements();
                console.log('‚úÖ Enhanced Notes with Chat Ready!');
            } catch (error) {
                console.error('‚ùå Initialization error:', error);
                alert('Error initializing app: ' + error.message);
            }
        });

        function checkAuthStatus() {
            const authData = localStorage.getItem('clearviewNotesAuth');
            if (authData) {
                try {
                    const { username, timestamp } = JSON.parse(authData);
                    const now = Date.now();
                    
                    if (now - timestamp < AUTH_CONFIG.sessionTimeout) {
                        currentUser = username;
                        showMainApp();
                        return;
                    } else {
                        localStorage.removeItem('clearviewNotesAuth');
                    }
                } catch (e) {
                    localStorage.removeItem('clearviewNotesAuth');
                }
            }
            
            showLoginScreen();
        }

        function setupEventListeners() {
            // Authentication - with multiple fallbacks to ensure it works
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            console.log('Setting up login listeners...');
            console.log('Login form found:', !!loginForm);
            console.log('Login button found:', !!loginBtn);
            
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('‚úì Form submit listener added');
            }
            
            // Also add direct click listener as backup
            if (loginBtn) {
                loginBtn.addEventListener('click', function(e) {
                    console.log('Login button clicked directly');
                    e.preventDefault();
                    handleLogin(e);
                });
                console.log('‚úì Button click listener added');
            }
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Tab Navigation
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Reminder functionality
            const setReminderBtn = document.getElementById('setReminderBtn');
            const clearReminderBtn = document.getElementById('clearReminderBtn');
            const reminderInput = document.getElementById('reminderInput');
            
            if (setReminderBtn) {
                setReminderBtn.addEventListener('click', setReminder);
            }
            
            if (clearReminderBtn) {
                clearReminderBtn.addEventListener('click', clearReminder);
            }
            
            if (reminderInput) {
                reminderInput.addEventListener('change', function() {
                    if (this.value) {
                        setReminderBtn.style.background = '#10b981';
                        setReminderBtn.style.color = 'white';
                    } else {
                        setReminderBtn.style.background = '';
                        setReminderBtn.style.color = '';
                    }
                });
            }
            
            // Notes functionality  
            const saveAsBtn = document.getElementById('saveAsBtn');
            const saveToGDriveBtn = document.getElementById('saveToGDriveBtn');
            const newNoteBtn = document.getElementById('newNoteBtn');
            const loadBtn = document.getElementById('loadBtn');
            const deleteNoteBtn = document.getElementById('deleteNoteBtn');
            const fileInput = document.getElementById('fileInput');
            const tagInput = document.getElementById('tagInput');
            const editor = document.getElementById('editor');
            
            if (saveAsBtn) {
                saveAsBtn.addEventListener('click', saveAsNote);
            }
            
            if (saveToGDriveBtn) {
                saveToGDriveBtn.addEventListener('click', saveToGoogleDrive);
            }
            
            if (newNoteBtn) {
                newNoteBtn.addEventListener('click', () => newNote(false));
            }
            
            if (loadBtn) {
                loadBtn.addEventListener('click', loadNote);
            }
            
            if (deleteNoteBtn) {
                deleteNoteBtn.addEventListener('click', deleteNote);
            }
            
            if (fileInput) {
                fileInput.addEventListener('change', handleFileLoad);
            }
            
            if (tagInput) {
                tagInput.addEventListener('keypress', handleTagInput);
            }
            
            if (editor) {
                editor.addEventListener('input', updateStats);
            }
            
            // Voice recording functionality
            const voiceBtn = document.getElementById('voiceBtn');
            const stopRecordingBtn = document.getElementById('stopRecordingBtn');
            const pauseRecordingBtn = document.getElementById('pauseRecordingBtn');
            const audioPlayBtn = document.getElementById('audioPlayBtn');
            const audioDeleteBtn = document.getElementById('audioDeleteBtn');
            
            if (voiceBtn) {
                voiceBtn.addEventListener('click', toggleRecording);
            }
            
            if (stopRecordingBtn) {
                stopRecordingBtn.addEventListener('click', stopRecording);
            }
            
            if (pauseRecordingBtn) {
                pauseRecordingBtn.addEventListener('click', togglePauseRecording);
            }
            
            if (audioPlayBtn) {
                audioPlayBtn.addEventListener('click', toggleAudioPlayback);
            }
            
            if (audioDeleteBtn) {
                audioDeleteBtn.addEventListener('click', deleteAudioRecording);
            }
            
            // Analytics functionality
            const detailedSortSelect = document.getElementById('detailedSortSelect');
            const exportDetailedBtn = document.getElementById('exportDetailedBtn');
            const viewAllTagsBtn = document.getElementById('viewAllTagsBtn');
            const clearAnalyticsBtn = document.getElementById('clearAnalyticsBtn');
            
            if (detailedSortSelect) {
                detailedSortSelect.addEventListener('change', function() {
                    currentSortMethod = this.value;
                    updateDetailedAnalytics();
                });
            }
            
            if (exportDetailedBtn) {
                exportDetailedBtn.addEventListener('click', exportTagAnalytics);
            }
            
            if (viewAllTagsBtn) {
                viewAllTagsBtn.addEventListener('click', showAllTagsModal);
            }
            
            if (clearAnalyticsBtn) {
                clearAnalyticsBtn.addEventListener('click', clearTagAnalytics);
            }
            
            // Browse Notes functionality
            const browseSearch = document.getElementById('browseSearch');
            const clearSearchBtn = document.getElementById('clearSearchBtn');
            const tagFilter = document.getElementById('tagFilter');
            const sortFilter = document.getElementById('sortFilter');
            const refreshNotesBtn = document.getElementById('refreshNotesBtn');
            
            if (browseSearch) {
                browseSearch.addEventListener('input', handleBrowseSearch);
            }
            
            if (clearSearchBtn) {
                clearSearchBtn.addEventListener('click', clearBrowseSearch);
            }
            
            if (tagFilter) {
                tagFilter.addEventListener('change', handleTagFilter);
            }
            
            if (sortFilter) {
                sortFilter.addEventListener('change', handleSortFilter);
            }
            
            if (refreshNotesBtn) {
                refreshNotesBtn.addEventListener('click', refreshNoteLibrary);
            }
        }

        function initializeEnhancements() {
            // Load tag history and analytics
            loadTagHistory();
            
            // Load note library
            loadNoteLibrary();
            
            // Load reminder if exists
            loadReminder();
            
            // Start reminder checking interval
            startReminderCheck();
            
            // Dark mode toggle
            const darkToggle = document.getElementById('darkModeToggle');
            if (darkToggle) {
                darkToggle.addEventListener('change', () => {
                    document.body.classList.toggle('dark-mode', darkToggle.checked);
                    localStorage.setItem('darkMode', darkToggle.checked);
                });
                
                // Restore dark mode preference
                if (localStorage.getItem('darkMode') === 'true') {
                    darkToggle.checked = true;
                    document.body.classList.add('dark-mode');
                }
            }
        }

        // Reminder Functions
        function setReminder() {
            const reminderInput = document.getElementById('reminderInput');
            const reminderDateTime = reminderInput.value;
            
            if (!reminderDateTime) {
                showSuccess('‚ö†Ô∏è Please select a date and time for the reminder.', true);
                return;
            }
            
            const reminderDate = new Date(reminderDateTime);
            const now = new Date();
            
            if (reminderDate <= now) {
                showSuccess('‚ö†Ô∏è Please select a future date and time.', true);
                return;
            }
            
            currentReminder = {
                dateTime: reminderDateTime,
                timestamp: reminderDate.getTime(),
                noteTitle: document.getElementById('filename').value || 'Untitled Note',
                setAt: now.toISOString()
            };
            
            saveReminder();
            updateReminderDisplay();
            showSuccess(`‚è∞ Reminder set for ${formatReminderDate(reminderDate)}!`);
        }
        
        function clearReminder() {
            if (confirm('Clear this reminder?')) {
                currentReminder = null;
                localStorage.removeItem('clearviewNotesReminder');
                updateReminderDisplay();
                showSuccess('üóëÔ∏è Reminder cleared.');
            }
        }
        
        function saveReminder() {
            if (currentReminder) {
                localStorage.setItem('clearviewNotesReminder', JSON.stringify(currentReminder));
            }
        }
        
        function loadReminder() {
            const saved = localStorage.getItem('clearviewNotesReminder');
            if (saved) {
                try {
                    currentReminder = JSON.parse(saved);
                    updateReminderDisplay();
                } catch (e) {
                    currentReminder = null;
                }
            }
        }
        
        function updateReminderDisplay() {
            const activeReminder = document.getElementById('activeReminder');
            const setBtn = document.getElementById('setReminderBtn');
            const clearBtn = document.getElementById('clearReminderBtn');
            const reminderInput = document.getElementById('reminderInput');
            
            if (currentReminder) {
                const reminderDate = new Date(currentReminder.timestamp);
                const now = new Date();
                const isOverdue = reminderDate <= now;
                
                // Show active reminder
                activeReminder.style.display = 'block';
                clearBtn.style.display = 'flex';
                
                // Update reminder info
                document.getElementById('reminderDate').textContent = formatReminderDate(reminderDate);
                
                // Add overdue class if needed
                if (isOverdue) {
                    activeReminder.classList.add('reminder-overdue');
                    document.getElementById('reminderCountdown').textContent = 'OVERDUE!';
                } else {
                    activeReminder.classList.remove('reminder-overdue');
                    updateCountdown();
                }
                
                // Clear input
                reminderInput.value = '';
                setBtn.style.background = '';
                setBtn.style.color = '';
            } else {
                activeReminder.style.display = 'none';
                clearBtn.style.display = 'none';
            }
        }
        
        function updateCountdown() {
            if (!currentReminder) return;
            
            const reminderDate = new Date(currentReminder.timestamp);
            const now = new Date();
            const diff = reminderDate - now;
            
            if (diff <= 0) {
                document.getElementById('reminderCountdown').textContent = 'OVERDUE!';
                document.getElementById('activeReminder').classList.add('reminder-overdue');
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            let countdownText = '';
            if (days > 0) {
                countdownText = `in ${days}d ${hours}h ${minutes}m`;
            } else if (hours > 0) {
                countdownText = `in ${hours}h ${minutes}m`;
            } else {
                countdownText = `in ${minutes}m`;
            }
            
            document.getElementById('reminderCountdown').textContent = countdownText;
        }
        
        function startReminderCheck() {
            // Update countdown every minute
            reminderInterval = setInterval(() => {
                if (currentReminder) {
                    updateCountdown();
                    
                    // Check if reminder time has been reached
                    const reminderDate = new Date(currentReminder.timestamp);
                    const now = new Date();
                    
                    if (reminderDate <= now && !currentReminder.notified) {
                        showReminderNotification();
                        currentReminder.notified = true;
                        saveReminder();
                    }
                }
            }, 60000); // Check every minute
        }
        
        function showReminderNotification() {
            // Browser notification if supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('üìù Clearview Notes Reminder', {
                    body: `Reminder for: ${currentReminder.noteTitle}`,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚è∞</text></svg>'
                });
            }
            
            // Visual notification in app
            showSuccess(`‚è∞ REMINDER: ${currentReminder.noteTitle}`, false, 10000);
            
            // Play a subtle sound if possible
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmofCTuBzvLZiTYIG2m98OScTgwOUarm7blmHQ==');
                audio.volume = 0.3;
                audio.play().catch(() => {}); // Ignore errors
            } catch (e) {}
        }
        
        function formatReminderDate(date) {
            const options = {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return date.toLocaleDateString(undefined, options);
        }
        
        // Request notification permission on app load
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Note Library Functions
        function loadNoteLibrary() {
            const saved = localStorage.getItem('clearviewNotesLibrary');
            if (saved) {
                try {
                    noteLibrary = JSON.parse(saved);
                } catch (e) {
                    noteLibrary = [];
                }
            }
            updateTagFilterOptions();
        }
        
        function saveNoteLibrary() {
            localStorage.setItem('clearviewNotesLibrary', JSON.stringify(noteLibrary));
        }
        
        function addNoteToLibrary(noteData, filename) {
            const noteEntry = {
                id: Date.now() + Math.random(), // Unique ID
                filename: filename,
                title: noteData.title,
                content: noteData.content,
                tags: noteData.tags || [],
                wordCount: noteData.content.trim() ? noteData.content.trim().split(/\s+/).length : 0,
                charCount: noteData.content.length,
                lastModified: noteData.lastModified,
                createdBy: noteData.createdBy,
                hasVoiceRecording: !!noteData.voiceRecording,
                hasReminder: !!noteData.reminder,
                savedAt: new Date().toISOString()
            };
            
            // Remove existing entry with same filename (update scenario)
            noteLibrary = noteLibrary.filter(note => note.filename !== filename);
            
            // Add new entry
            noteLibrary.unshift(noteEntry); // Add to beginning (most recent first)
            
            // Limit to last 100 notes to prevent storage issues
            if (noteLibrary.length > 100) {
                noteLibrary = noteLibrary.slice(0, 100);
            }
            
            saveNoteLibrary();
            updateTagFilterOptions();
        }
        
        function removeNoteFromLibrary(noteId) {
            noteLibrary = noteLibrary.filter(note => note.id !== noteId);
            saveNoteLibrary();
            updateBrowseDisplay();
            updateTagFilterOptions();
        }
        
        function updateTagFilterOptions() {
            const tagFilter = document.getElementById('tagFilter');
            if (!tagFilter) return;
            
            // Get all unique tags from the library
            const allTags = new Set();
            noteLibrary.forEach(note => {
                note.tags.forEach(tag => allTags.add(tag));
            });
            
            // Clear existing options except "All Tags"
            tagFilter.innerHTML = '<option value="">All Tags</option>';
            
            // Add tag options
            Array.from(allTags).sort().forEach(tag => {
                const option = document.createElement('option');
                option.value = tag;
                option.textContent = tag;
                tagFilter.appendChild(option);
            });
        }
        
        function handleBrowseSearch() {
            const searchInput = document.getElementById('browseSearch');
            const clearBtn = document.getElementById('clearSearchBtn');
            
            currentSearchTerm = searchInput.value.toLowerCase().trim();
            
            if (currentSearchTerm) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
            
            updateBrowseDisplay();
        }
        
        function clearBrowseSearch() {
            const searchInput = document.getElementById('browseSearch');
            const clearBtn = document.getElementById('clearSearchBtn');
            
            searchInput.value = '';
            currentSearchTerm = '';
            clearBtn.style.display = 'none';
            
            updateBrowseDisplay();
        }
        
        function handleTagFilter() {
            const tagFilter = document.getElementById('tagFilter');
            currentTagFilter = tagFilter.value;
            updateBrowseDisplay();
        }
        
        function handleSortFilter() {
            const sortFilter = document.getElementById('sortFilter');
            currentSortFilter = sortFilter.value;
            updateBrowseDisplay();
        }
        
        function refreshNoteLibrary() {
            loadNoteLibrary();
            updateBrowseDisplay();
            showSuccess('üîÑ Note library refreshed!');
        }
        
        function updateBrowseDisplay() {
            // Filter notes based on search and tag filter
            filteredNotes = noteLibrary.filter(note => {
                // Search filter
                const matchesSearch = !currentSearchTerm || 
                    note.title.toLowerCase().includes(currentSearchTerm) ||
                    note.content.toLowerCase().includes(currentSearchTerm) ||
                    note.filename.toLowerCase().includes(currentSearchTerm) ||
                    note.tags.some(tag => tag.toLowerCase().includes(currentSearchTerm));
                
                // Tag filter
                const matchesTag = !currentTagFilter || note.tags.includes(currentTagFilter);
                
                return matchesSearch && matchesTag;
            });
            
            // Sort filtered notes
            filteredNotes.sort((a, b) => {
                switch (currentSortFilter) {
                    case 'recent':
                        return new Date(b.savedAt) - new Date(a.savedAt);
                    case 'oldest':
                        return new Date(a.savedAt) - new Date(b.savedAt);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'size':
                        return b.wordCount - a.wordCount;
                    default:
                        return new Date(b.savedAt) - new Date(a.savedAt);
                }
            });
            
            updateBrowseStats();
            displayNotes();
        }
        
        function updateBrowseStats() {
            const totalNotes = noteLibrary.length;
            const filteredCount = filteredNotes.length;
            const totalWords = noteLibrary.reduce((sum, note) => sum + note.wordCount, 0);
            
            document.getElementById('totalNotes').textContent = totalNotes;
            document.getElementById('filteredNotes').textContent = filteredCount;
            document.getElementById('totalWords').textContent = totalWords.toLocaleString();
        }
        
        function displayNotes() {
            const notesGrid = document.getElementById('notesGrid');
            if (!notesGrid) return;
            
            if (filteredNotes.length === 0) {
                if (noteLibrary.length === 0) {
                    // No notes at all
                    notesGrid.innerHTML = `
                        <div class="empty-library">
                            <div class="empty-icon">üìö</div>
                            <div class="empty-title">No notes in your library yet</div>
                            <div class="empty-text">
                                Notes you save through this app will appear here for easy browsing and loading.
                                <br><br>
                                <strong>To get started:</strong>
                                <br>1. Go to the Notes tab
                                <br>2. Write some content and add tags
                                <br>3. Use "Save As" or "Save to Google Drive"
                                <br>4. Your notes will appear here automatically
                            </div>
                        </div>
                    `;
                } else {
                    // Notes exist but none match filter
                    notesGrid.innerHTML = `
                        <div class="empty-library">
                            <div class="empty-icon">üîç</div>
                            <div class="empty-title">No notes match your search</div>
                            <div class="empty-text">
                                Try adjusting your search terms or tag filter to find what you're looking for.
                                <br><br>
                                <strong>Search tips:</strong>
                                <br>‚Ä¢ Search by title, content, or tags
                                <br>‚Ä¢ Use the tag filter to narrow results
                                <br>‚Ä¢ Check your sorting preferences
                            </div>
                        </div>
                    `;
                }
                return;
            }
            
            notesGrid.innerHTML = '';
            
            filteredNotes.forEach(note => {
                const noteCard = createNoteCard(note);
                notesGrid.appendChild(noteCard);
            });
        }
        
        function createNoteCard(note) {
            const card = document.createElement('div');
            card.className = 'note-card';
            
            // Create preview text (first 150 characters)
            const preview = note.content.length > 150 ? 
                note.content.substring(0, 150) + '...' : 
                note.content || 'No content';
            
            // Format date
            const date = new Date(note.savedAt);
            const dateStr = date.toLocaleDateString(undefined, {
                month: 'short',
                day: 'numeric',
                year: date.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
            });
            
            // Create tags HTML
            const tagsHtml = note.tags.map(tag => 
                `<span class="note-tag">${tag}</span>`
            ).join('');
            
            // Create indicators
            const indicators = [];
            if (note.hasVoiceRecording) indicators.push('üé§');
            if (note.hasReminder) indicators.push('‚è∞');
            
            card.innerHTML = `
                <div class="note-header">
                    <div>
                        <div class="note-title">${note.title}</div>
                        <div class="note-filename">${note.filename}</div>
                    </div>
                    <div class="note-actions">
                        <button class="note-action-btn load" onclick="loadNoteFromLibrary('${note.id}')" title="Load this note">üìÇ Load</button>
                        <button class="note-action-btn delete" onclick="deleteNoteFromLibrary('${note.id}')" title="Remove from library">üóëÔ∏è</button>
                    </div>
                </div>
                
                <div class="note-preview">${preview}</div>
                
                <div class="note-tags">${tagsHtml}</div>
                
                <div class="note-meta">
                    <div class="note-date">
                        üìÖ ${dateStr}
                    </div>
                    <div class="note-stats">
                        <div class="note-indicator" title="Word count">üìù ${note.wordCount}</div>
                        ${indicators.map(icon => `<span title="Has ${icon === 'üé§' ? 'voice recording' : 'reminder'}">${icon}</span>`).join('')}
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Make these functions globally available for onclick handlers
        window.loadNoteFromLibrary = function(noteId) {
            const note = noteLibrary.find(n => n.id.toString() === noteId.toString());
            if (!note) {
                showSuccess('‚ùå Note not found in library.', true);
                return;
            }
            
            // Confirm loading if current note has content
            const hasCurrentContent = document.getElementById('editor').value.trim();
            if (hasCurrentContent && !confirm(`Load "${note.title}"? This will replace your current note.`)) {
                return;
            }
            
            // Load the note data
            document.getElementById('filename').value = note.filename;
            document.getElementById('editor').value = note.content;
            tags = [...note.tags];
            
            // Update displays
            updateTagsDisplay();
            updateDetailedAnalytics();
            updateStats();
            
            // Switch to notes tab
            switchTab('notes');
            
            showSuccess(`üìÅ Loaded "${note.title}" successfully!`);
            
            // Add tags to history
            note.tags.forEach(tag => addToTagHistory(tag));
        };
        
        window.deleteNoteFromLibrary = function(noteId) {
            const note = noteLibrary.find(n => n.id.toString() === noteId.toString());
            if (!note) return;
            
            if (confirm(`Remove "${note.title}" from your library? This will not delete the saved file, only remove it from this browser's library.`)) {
                removeNoteFromLibrary(note.id);
                showSuccess(`üóëÔ∏è Removed "${note.title}" from library.`);
            }
        };

        // Existing functions from the analytics version...
        
        // Tag Analytics Management Functions
        function showAllTagsModal() {
            if (tagHistory.length === 0) {
                showSuccess('üìù No tags to display yet! Start adding tags to your notes.', false, 3000);
                return;
            }
            
            // Create modal HTML
            const modalHTML = `
                <div class="tag-list-modal" id="tagListModal">
                    <div class="tag-list-content">
                        <div class="tag-list-header">
                            <div class="tag-list-title">üìã All Your Tags (${tagHistory.length})</div>
                            <button class="close-modal" onclick="closeTagListModal()">‚úï Close</button>
                        </div>
                        <div class="tag-list-grid" id="tagListGrid">
                            ${tagHistory.map(item => `
                                <div class="tag-item-display">
                                    <div class="tag-item-name">${item.tag}</div>
                                    <div class="tag-item-count">${item.count} use${item.count !== 1 ? 's' : ''}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            
            // Add to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            document.getElementById('tagListModal').classList.add('show');
            
            // Close on overlay click
            document.getElementById('tagListModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeTagListModal();
                }
            });
        }
        
        // Make closeTagListModal globally available
        window.closeTagListModal = function() {
            const modal = document.getElementById('tagListModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function clearTagAnalytics() {
            if (tagHistory.length === 0) {
                showSuccess('üìä Analytics are already empty!', false, 2000);
                return;
            }
            
            const confirmMessage = `Are you sure you want to clear all tag analytics? This will remove ${tagHistory.length} tags and cannot be undone.`;
            
            if (confirm(confirmMessage)) {
                // Clear all tag history
                tagHistory = [];
                saveTagHistory();
                updateDetailedAnalytics();
                
                showSuccess('üóëÔ∏è Tag analytics cleared! Analytics will now only show tags you actually use.', false, 4000);
            }
        }

        // Tab Management
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            if (tabName === 'notes') {
                document.getElementById('notesTab').classList.add('active');
            } else if (tabName === 'analytics') {
                document.getElementById('analyticsTab').classList.add('active');
                updateDetailedAnalytics(); // Refresh analytics when switching to tab
            } else if (tabName === 'browse') {
                document.getElementById('browseTab').classList.add('active');
                loadNoteLibrary(); // Load notes when switching to browse tab
                updateBrowseDisplay();
            }
            
            currentTab = tabName;
        }

        function handleLogin(e) {
            console.log('üîê Login attempt started');
            e.preventDefault();
            
            try {
                const usernameInput = document.getElementById('usernameInput');
                const passwordInput = document.getElementById('passwordInput');
                
                if (!usernameInput || !passwordInput) {
                    console.error('‚ùå Login inputs not found');
                    showLoginError('Login form error. Please refresh the page.');
                    return;
                }
                
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                
                console.log('Username entered:', username);
                console.log('Checking against users:', Object.keys(AUTH_CONFIG.users));
                
                if (AUTH_CONFIG.users[username] === password) {
                    console.log('‚úÖ Login successful');
                    currentUser = username;
                    
                    const authData = {
                        username: username,
                        timestamp: Date.now()
                    };
                    
                    localStorage.setItem('clearviewNotesAuth', JSON.stringify(authData));
                    showMainApp();
                } else {
                    console.log('‚ùå Login failed - invalid credentials');
                    showLoginError('Invalid username or password. Please try again.');
                    passwordInput.value = '';
                }
            } catch (error) {
                console.error('‚ùå Login error:', error);
                showLoginError('Login error occurred. Please try again.');
            }
        }

        function handleLogout() {
            const hasContent = document.getElementById('editor').value.trim();
            const confirmMessage = hasContent ? 
                'You have unsaved changes. Are you sure you want to logout?' : 
                'Are you sure you want to logout?';
                
            if (confirm(confirmMessage)) {
                // Clear reminder interval
                if (reminderInterval) {
                    clearInterval(reminderInterval);
                    reminderInterval = null;
                }
                
                localStorage.removeItem('clearviewNotesAuth');
                currentUser = '';
                isAuthenticated = false;
                showLoginScreen();
                clearAppData();
            }
        }

        function showLoginScreen() {
            document.getElementById('loginOverlay').style.display = 'flex';
            document.getElementById('mainApp').style.visibility = 'hidden';
            document.getElementById('usernameInput').focus();
            isAuthenticated = false;
        }

        function showMainApp() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainApp').style.visibility = 'visible';
            isAuthenticated = true;
            document.getElementById('sessionInfo').textContent = `Welcome, ${currentUser}!`;
            newNote(true);
            updateDetailedAnalytics();
        }

        function showLoginError(message) {
            console.log('Showing login error:', message);
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 5000);
            } else {
                console.error('Login error div not found');
                alert(message); // Fallback
            }
        }

        function clearAppData() {
            document.getElementById('editor').value = '';
            document.getElementById('filename').value = '';
            document.getElementById('tagInput').value = '';
            document.getElementById('reminderInput').value = '';
            tags = [];
            
            // Clear voice recording
            currentAudioData = null;
            if (audioElement) {
                audioElement.pause();
                audioElement = null;
            }
            const waveform = document.getElementById('recordingWaveform');
            waveform.innerHTML = '';
            
            // Clear reminder
            currentReminder = null;
            localStorage.removeItem('clearviewNotesReminder');
            
            updateTagsDisplay();
            updateDetailedAnalytics();
            updateAudioPlaybackUI();
            updateReminderDisplay();
            updateStats();
        }

        // Enhanced Tag Analytics Functions
        function loadTagHistory() {
            const saved = localStorage.getItem('clearviewNotesTagHistory');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    tagHistory = parsed.map(item => ({
                        tag: item.tag || item,
                        count: item.count || 1,
                        lastUsed: item.lastUsed || new Date().toISOString(),
                        trend: item.trend || 'stable'
                    }));
                } catch (e) {
                    tagHistory = [];
                }
            }
            updateDetailedAnalytics();
        }
        
        function saveTagHistory() {
            localStorage.setItem('clearviewNotesTagHistory', JSON.stringify(tagHistory));
        }
        
        function addToTagHistory(tag) {
            const existing = tagHistory.find(item => item.tag === tag);
            const now = new Date().toISOString();
            
            if (existing) {
                const oldCount = existing.count;
                existing.count++;
                existing.lastUsed = now;
                
                // Calculate trend
                const dayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString();
                if (existing.lastUsed > dayAgo) {
                    existing.trend = oldCount < existing.count ? 'up' : 'stable';
                } else {
                    existing.trend = 'down';
                }
            } else {
                tagHistory.push({
                    tag: tag,
                    count: 1,
                    lastUsed: now,
                    trend: 'up'
                });
            }
            
            saveTagHistory();
            updateDetailedAnalytics();
        }
        
        function updateDetailedAnalytics() {
            const totalTags = tagHistory.length;
            const totalUsage = tagHistory.reduce((sum, item) => sum + item.count, 0);
            const averageUse = totalTags > 0 ? Math.round(totalUsage / totalTags * 10) / 10 : 0;
            const activeTags = tags.length;
            
            // Update overview stats
            document.getElementById('totalTagsDetailed').textContent = totalTags;
            document.getElementById('totalUsageDetailed').textContent = totalUsage;
            document.getElementById('averageUseDetailed').textContent = averageUse;
            document.getElementById('activeTagsDetailed').textContent = activeTags;
            
            updateHotTopicsDetailed();
            updateDetailedTagList();
        }
        
        function updateHotTopicsDetailed() {
            const hotTopicsContainer = document.getElementById('hotTopicsDetailed');
            if (!hotTopicsContainer) return;
            
            const sortedTags = [...tagHistory]
                .sort((a, b) => b.count - a.count)
                .slice(0, 6);
            
            if (sortedTags.length === 0) {
                hotTopicsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üè∑Ô∏è</div>
                        <div class="empty-title">No hot topics yet!</div>
                        <div class="empty-text">Start adding tags to your notes to see your most-used topics here. Tags help you discover patterns in your thinking and research.</div>
                    </div>
                `;
                return;
            }
            
            const totalUsage = tagHistory.reduce((sum, item) => sum + item.count, 0);
            
            hotTopicsContainer.innerHTML = '';
            
            sortedTags.forEach(item => {
                const hotTagCard = document.createElement('div');
                hotTagCard.className = 'hot-tag-card';
                
                if (item.count >= 5) { // Lowered threshold for real user data
                    hotTagCard.classList.add('ultra-hot');
                }
                
                const percentage = totalUsage > 0 ? Math.round((item.count / totalUsage) * 100) : 0;
                
                hotTagCard.innerHTML = `
                    <div class="hot-tag-name">${item.tag}</div>
                    <div class="hot-tag-stats">${item.count} uses ‚Ä¢ ${percentage}% ‚Ä¢ ${getTrendIcon(item.trend)}</div>
                `;
                
                hotTagCard.addEventListener('click', () => addTagFromHistory(item.tag));
                hotTopicsContainer.appendChild(hotTagCard);
            });
        }
        
        function updateDetailedTagList() {
            const container = document.getElementById('detailedTagList');
            if (!container) return;
            
            if (tagHistory.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <div class="empty-title">No tag analytics yet</div>
                        <div class="empty-text">Your tag analytics will appear here as you add tags to your notes. This helps you understand your research patterns and discover your most important topics.</div>
                    </div>
                `;
                return;
            }
            
            const sortedTags = sortTagHistory(currentSortMethod);
            const maxCount = Math.max(...tagHistory.map(item => item.count));
            const totalUsage = tagHistory.reduce((sum, item) => sum + item.count, 0);
            
            container.innerHTML = '';
            
            sortedTags.forEach(item => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-detail-item';
                
                const heatLevel = getHeatLevel(item.count, maxCount);
                if (heatLevel > 0) {
                    tagElement.classList.add(`heat-${heatLevel}`);
                }
                
                const percentage = totalUsage > 0 ? Math.round((item.count / totalUsage) * 100) : 0;
                const timeAgo = getTimeAgo(new Date(item.lastUsed));
                
                tagElement.innerHTML = `
                    <div class="tag-indicators">
                        ${item.count >= 5 ? 'üî•' : item.count >= 3 ? '‚≠ê' : ''}
                    </div>
                    <div class="tag-detail-info">
                        <div class="tag-detail-name">${item.tag}</div>
                        <div class="tag-detail-meta">Last used ${timeAgo} ‚Ä¢ Trending ${getTrendIcon(item.trend)}</div>
                    </div>
                    <div class="tag-detail-metrics">
                        <div class="tag-metric-primary">${item.count}x</div>
                        <div class="tag-metric-secondary">${percentage}%</div>
                    </div>
                `;
                
                tagElement.addEventListener('click', () => {
                    addTagFromHistory(item.tag);
                    switchTab('notes'); // Switch back to notes tab after adding
                });
                container.appendChild(tagElement);
            });
        }
        
        // Utility Functions
        function getHeatLevel(count, maxCount) {
            if (maxCount === 0) return 0;
            const percentage = (count / maxCount) * 100;
            
            // Adjusted thresholds for real user data (not demo data)
            if (percentage >= 90) return 5; // Ultra hot - your most used tag
            if (percentage >= 70) return 4; // Very hot 
            if (percentage >= 50) return 3; // Hot
            if (percentage >= 30) return 2; // Warm
            if (percentage > 0) return 1;   // Cool
            return 0; // None
        }
        
        function getTrendIcon(trend) {
            switch(trend) {
                case 'up': return 'üìà';
                case 'down': return 'üìâ';
                default: return '‚û°Ô∏è';
            }
        }
        
        function sortTagHistory(method) {
            switch(method) {
                case 'usage':
                    return tagHistory.sort((a, b) => {
                        if (b.count !== a.count) return b.count - a.count;
                        return new Date(b.lastUsed) - new Date(a.lastUsed);
                    });
                    
                case 'recent':
                    return tagHistory.sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
                    
                case 'alpha':
                    return tagHistory.sort((a, b) => a.tag.localeCompare(b.tag));
                    
                case 'trending':
                    return tagHistory.sort((a, b) => {
                        const trendOrder = { 'up': 3, 'stable': 2, 'down': 1 };
                        if (trendOrder[b.trend] !== trendOrder[a.trend]) {
                            return trendOrder[b.trend] - trendOrder[a.trend];
                        }
                        return b.count - a.count;
                    });
                    
                default:
                    return tagHistory;
            }
        }
        
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'now';
        }
        
        function addTagFromHistory(tag) {
            if (!tags.includes(tag)) {
                tags.push(tag);
                addToTagHistory(tag);
                updateTagsDisplay();
                updateDetailedAnalytics();
                showSuccess(`üè∑Ô∏è Added tag: "${tag}"`);
            } else {
                showSuccess('‚ö†Ô∏è Tag already added to this note!', true);
            }
        }
        
        function exportTagAnalytics() {
            if (tagHistory.length === 0) {
                showSuccess('üìä No tag data to export yet! Start adding tags to your notes.', false, 3000);
                return;
            }
            
            const csvData = generateTagAnalyticsCSV();
            const blob = new Blob([csvData], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `my-tag-analytics-${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSuccess(`üì§ Exported ${tagHistory.length} tags to CSV!`);
        }
        
        function generateTagAnalyticsCSV() {
            const headers = ['Your Tag', 'Usage Count', 'Usage Percentage', 'Last Used', 'Trend', 'Heat Level'];
            const totalUsage = tagHistory.reduce((sum, item) => sum + item.count, 0);
            const maxCount = Math.max(...tagHistory.map(item => item.count));
            
            const rows = tagHistory.map(item => {
                const percentage = totalUsage > 0 ? Math.round((item.count / totalUsage) * 100) : 0;
                const heatLevel = getHeatLevel(item.count, maxCount);
                
                return [
                    item.tag,
                    item.count,
                    `${percentage}%`,
                    new Date(item.lastUsed).toLocaleDateString(),
                    item.trend,
                    heatLevel
                ].join(',');
            });
            
            return [headers.join(','), ...rows].join('\n');
        }

        // Standard Notes Functions
        function createNoteData() {
            const content = document.getElementById('editor').value;
            const autoTitle = generateAutoTitle(content);
            
            const noteData = { 
                title: autoTitle,
                content: content, 
                tags: tags, 
                lastModified: new Date().toISOString(),
                createdBy: currentUser
            };
            
            // Include audio data if it exists
            if (currentAudioData) {
                noteData.voiceRecording = currentAudioData;
            }
            
            // Include reminder data if it exists
            if (currentReminder) {
                noteData.reminder = currentReminder;
            }
            
            return noteData;
        }
        
        function generateAutoTitle(content) {
            if (!content.trim()) return 'Empty Note';
            
            // Extract first meaningful line (up to 50 chars)
            const firstLine = content.trim().split('\n')[0];
            if (firstLine.length <= 50) return firstLine;
            
            // Truncate at word boundary
            const truncated = firstLine.substring(0, 50);
            const lastSpace = truncated.lastIndexOf(' ');
            return lastSpace > 20 ? truncated.substring(0, lastSpace) + '...' : truncated + '...';
        }
        
        // Enhanced Save Functions
        function saveAsNote() {
            const noteData = createNoteData();
            if (!noteData.content.trim() && !currentAudioData) {
                showSuccess('‚ö†Ô∏è Add content or record audio before saving!', true);
                return;
            }
            
            const filename = document.getElementById('filename').value || 'notes';
            
            // Check if we're in an iframe (like Claude's artifact viewer)
            const isInIframe = window !== window.parent;
            
            // Try modern File System Access API only if not in iframe and supported
            if (!isInIframe && 'showSaveFilePicker' in window) {
                saveWithFilePicker(noteData, filename);
            } else {
                // Use fallback method
                saveWithFallback(noteData, filename, isInIframe);
            }
        }
        
        async function saveWithFilePicker(noteData, filename) {
            try {
                const fileHandle = await window.showSaveFilePicker({
                    suggestedName: `${filename}.json`,
                    types: [{
                        description: 'Clearview Notes files',
                        accept: { 'application/json': ['.json'] }
                    }]
                });
                
                // Create the file content
                const content = JSON.stringify(noteData, null, 2);
                const writable = await fileHandle.createWritable();
                await writable.write(content);
                await writable.close();
                
                // Remember this location
                const savedLocation = {
                    name: fileHandle.name,
                    timestamp: Date.now()
                };
                localStorage.setItem('clearviewNotesLastSave', JSON.stringify(savedLocation));
                
                const audioInfo = currentAudioData ? ` (with ${Math.floor(currentAudioData.duration)}s voice recording)` : '';
                const savedMessage = `üíæ **Saved: ${fileHandle.name}**${audioInfo}

üìÇ **Location**: Successfully saved to your chosen folder
‚úÖ **File size**: ${formatFileSize(content.length)}
üè∑Ô∏è **Tags**: ${tags.length} tag${tags.length !== 1 ? 's' : ''} included
${currentAudioData ? `üé§ **Audio**: ${Math.floor(currentAudioData.duration)}s voice recording included` : ''}

üîÑ **To reload later**: Use "Load Note" button and select this file`;
                
                showSuccess(savedMessage, false, 5000);
                
                // Add note to library
                addNoteToLibrary(noteData, fileHandle.name.replace(/\.json$/, ''));
                
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.log('File picker failed, falling back to download:', error.message);
                    // Fall back to regular download
                    saveWithFallback(noteData, filename, false);
                } else {
                    showSuccess('üí≠ Save cancelled', false, 2000);
                }
            }
        }
        
        function saveWithFallback(noteData, filename, isInIframe = false) {
            const blob = new Blob([JSON.stringify(noteData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Remember this download
            const savedLocation = {
                name: `${filename}.json`,
                timestamp: Date.now()
            };
            localStorage.setItem('clearviewNotesLastSave', JSON.stringify(savedLocation));
            
            let downloadMessage;
            if (isInIframe) {
                downloadMessage = `üíæ **Downloaded: ${filename}.json**

üìÇ **Location**: Your browser's Downloads folder
üñºÔ∏è **Running in**: Claude artifact viewer (limited file picker access)
üì± **Mobile**: Check your device's Downloads app  
üñ•Ô∏è **Desktop**: Usually ~/Downloads folder

üí° **Tip**: To get folder selection, copy this app to run directly in your browser

üîÑ **To reload later**: Use "Load Note" button and select this file`;
            } else {
                downloadMessage = `üíæ **Downloaded: ${filename}.json**

üìÇ **Location**: Your browser's Downloads folder
üì± **Mobile**: Check your device's Downloads app  
üñ•Ô∏è **Desktop**: Usually ~/Downloads folder

üí° **Note**: Your browser doesn't support advanced file picker features

üîÑ **To reload later**: Use "Load Note" button and select this file`;
            }
            
            showSuccess(downloadMessage, false, 5000);
            
            // Add note to library
            addNoteToLibrary(noteData, filename);
        }
        
        function saveToGoogleDrive() {
            const noteData = createNoteData();
            if (!noteData.content.trim()) {
                showSuccess('‚ö†Ô∏è Add content before saving to Google Drive!', true);
                return;
            }

            const filename = document.getElementById('filename').value || 'notes';
            const btn = document.getElementById('saveToGDriveBtn');
            
            btn.disabled = true;
            btn.textContent = 'üì§ Preparing...';

            try {
                // Try Web Share API first (mobile-friendly)
                if (navigator.share && navigator.canShare) {
                    const fileToShare = new File(
                        [JSON.stringify(noteData, null, 2)], 
                        `${filename}.json`, 
                        { type: 'application/json' }
                    );

                    if (navigator.canShare({ files: [fileToShare] })) {
                        navigator.share({
                            files: [fileToShare],
                            title: noteData.title,
                            text: 'Clearview Notes - Enhanced with Analytics & Chat'
                        }).then(() => {
                            showSuccess('‚úÖ Shared! Select Google Drive to save.');
                            resetGDriveButton();
                        }).catch((error) => {
                            if (error.name !== 'AbortError') {
                                fallbackGoogleDriveMethod(noteData, filename);
                            } else {
                                resetGDriveButton();
                            }
                        });
                        return;
                    }
                }
                
                // Fallback for desktop browsers
                fallbackGoogleDriveMethod(noteData, filename);
                
            } catch (error) {
                fallbackGoogleDriveMethod(noteData, filename);
            }
        }

        function fallbackGoogleDriveMethod(noteData, filename) {
            // Download the file first
            const blob = new Blob([JSON.stringify(noteData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.json`;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Open Google Drive
            setTimeout(() => {
                const driveUrl = 'https://drive.google.com/drive/my-drive';
                window.open(driveUrl, '_blank');
                
                showSuccess(`üìÅ **Downloaded: ${filename}.json**
üì§ **Google Drive opened!**

**Upload Steps:**
1. Click "New" ‚Üí "File upload" in Google Drive
2. Select your downloaded file
3. Optional: Create "Clearview-Notes" folder for organization
4. Move file to your preferred Drive location

**Features Included:**
‚Ä¢ Complete note content and tags
‚Ä¢ Auto-generated title from content
‚Ä¢ Voice recordings (if any)
‚Ä¢ Active reminders (if any)
‚Ä¢ Timestamp and user information
‚Ä¢ Ready for Google Drive storage`, false, 8000);
                
                // Add note to library
                addNoteToLibrary(noteData, filename);
                
                resetGDriveButton();
            }, 500);
        }

        function resetGDriveButton() {
            const btn = document.getElementById('saveToGDriveBtn');
            if (btn) {
                btn.disabled = false;
                btn.textContent = 'üì§ Save to Google Drive';
            }
        }
        
        function deleteNote() {
            const hasContent = document.getElementById('editor').value.trim();
            const hasFilename = document.getElementById('filename').value.trim();
            const hasAudio = currentAudioData !== null;
            
            if (!hasContent && !hasFilename && !hasAudio) {
                showSuccess('üìù Note is already empty!', false, 2000);
                return;
            }
            
            // Custom confirmation dialog for delete
            let confirmMessage = 'Are you sure you want to delete this note? This action cannot be undone.';
            if (hasAudio) {
                confirmMessage = 'Are you sure you want to delete this note and its voice recording? This action cannot be undone.';
            }
                
            if (confirm(confirmMessage)) {
                // Clear all note data
                document.getElementById('editor').value = '';
                document.getElementById('filename').value = '';
                document.getElementById('tagInput').value = '';
                tags = [];
                
                // Clear voice recording
                currentAudioData = null;
                if (audioElement) {
                    audioElement.pause();
                    audioElement = null;
                }
                const waveform = document.getElementById('recordingWaveform');
                waveform.innerHTML = '';
                
                updateTagsDisplay();
                updateDetailedAnalytics();
                updateAudioPlaybackUI();
                updateStats();
                
                const deleteMessage = hasAudio ? 'üóëÔ∏è Note and voice recording deleted!' : 'üóëÔ∏è Note deleted successfully!';
                showSuccess(deleteMessage, false, 3000);
                
                // Focus on editor for new content
                document.getElementById('editor').focus();
            }
        }
        
        // Voice Recording Functions (keeping all the original voice functionality)
        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }
        
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        sampleRate: 44100
                    } 
                });
                
                audioChunks = [];
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });
                
                mediaRecorder.addEventListener('dataavailable', event => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                });
                
                mediaRecorder.addEventListener('stop', () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm;codecs=opus' });
                    processRecordedAudio(audioBlob);
                    
                    // Stop all tracks to release microphone
                    stream.getTracks().forEach(track => track.stop());
                });
                
                mediaRecorder.start(100); // Collect data every 100ms
                isRecording = true;
                isPaused = false;
                recordingStartTime = Date.now();
                
                updateRecordingUI();
                startRecordingTimer();
                startWaveformAnimation();
                
                showSuccess('üé§ Recording started! Speak naturally.', false, 2000);
                
            } catch (error) {
                console.error('Error starting recording:', error);
                showSuccess('‚ùå Could not access microphone. Please check permissions.', true);
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                isPaused = false;
                
                clearInterval(recordingTimer);
                updateRecordingUI();
                
                showSuccess('üé§ Recording saved!', false, 2000);
            }
        }
        
        function togglePauseRecording() {
            if (!mediaRecorder || !isRecording) return;
            
            if (isPaused) {
                mediaRecorder.resume();
                isPaused = false;
                startRecordingTimer();
                showSuccess('üé§ Recording resumed', false, 1500);
            } else {
                mediaRecorder.pause();
                isPaused = true;
                clearInterval(recordingTimer);
                showSuccess('‚è∏Ô∏è Recording paused', false, 1500);
            }
            
            updateRecordingUI();
        }
        
        function processRecordedAudio(audioBlob) {
            const reader = new FileReader();
            reader.onload = function(e) {
                currentAudioData = {
                    data: e.target.result, // Base64 data URL
                    size: audioBlob.size,
                    duration: (Date.now() - recordingStartTime) / 1000,
                    timestamp: new Date().toISOString()
                };
                
                updateAudioPlaybackUI();
            };
            reader.readAsDataURL(audioBlob);
        }
        
        function updateRecordingUI() {
            const voiceBtn = document.getElementById('voiceBtn');
            const voiceControls = document.getElementById('voiceControls');
            const pauseBtn = document.getElementById('pauseRecordingBtn');
            
            if (isRecording) {
                voiceBtn.classList.add('recording');
                voiceBtn.innerHTML = 'üî¥';
                voiceBtn.title = 'Recording... Click to stop';
                voiceControls.classList.add('active');
                
                if (isPaused) {
                    pauseBtn.innerHTML = '‚ñ∂Ô∏è Resume';
                    pauseBtn.classList.remove('pause');
                } else {
                    pauseBtn.innerHTML = '‚è∏Ô∏è Pause';
                    pauseBtn.classList.add('pause');
                }
            } else {
                voiceBtn.classList.remove('recording');
                voiceBtn.innerHTML = 'üé§';
                voiceBtn.title = 'Record voice note';
                voiceControls.classList.remove('active');
            }
        }
        
        function startRecordingTimer() {
            const timerElement = document.getElementById('recordingTimer');
            
            recordingTimer = setInterval(() => {
                if (!isPaused) {
                    const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        function startWaveformAnimation() {
            const waveform = document.getElementById('recordingWaveform');
            
            // Create animated bars
            for (let i = 0; i < 20; i++) {
                const bar = document.createElement('div');
                bar.className = 'waveform-bar';
                bar.style.left = `${i * 5}px`;
                waveform.appendChild(bar);
                
                // Animate bars with random heights
                const animateBar = () => {
                    if (isRecording && !isPaused) {
                        const height = Math.random() * 20;
                        bar.style.height = `${height}px`;
                    }
                };
                
                setInterval(animateBar, 100 + Math.random() * 200);
            }
        }
        
        function updateAudioPlaybackUI() {
            const audioPlayback = document.getElementById('audioPlayback');
            const audioDuration = document.getElementById('audioDuration');
            
            if (currentAudioData) {
                audioPlayback.classList.add('active');
                
                const minutes = Math.floor(currentAudioData.duration / 60);
                const seconds = Math.floor(currentAudioData.duration % 60);
                audioDuration.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                audioPlayback.classList.remove('active');
            }
        }
        
        function toggleAudioPlayback() {
            if (!currentAudioData) return;
            
            const playBtn = document.getElementById('audioPlayBtn');
            
            if (audioElement && !audioElement.paused) {
                audioElement.pause();
                playBtn.innerHTML = '‚ñ∂Ô∏è';
            } else {
                if (audioElement) {
                    audioElement.play();
                } else {
                    audioElement = new Audio(currentAudioData.data);
                    audioElement.addEventListener('ended', () => {
                        playBtn.innerHTML = '‚ñ∂Ô∏è';
                    });
                    audioElement.play();
                }
                playBtn.innerHTML = '‚è∏Ô∏è';
            }
        }
        
        function deleteAudioRecording() {
            if (!currentAudioData) return;
            
            if (confirm('Delete this voice recording? This action cannot be undone.')) {
                currentAudioData = null;
                
                if (audioElement) {
                    audioElement.pause();
                    audioElement = null;
                }
                
                // Clear waveform
                const waveform = document.getElementById('recordingWaveform');
                waveform.innerHTML = '';
                
                updateAudioPlaybackUI();
                showSuccess('üóëÔ∏è Voice recording deleted', false, 2000);
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function newNote(isInitial) {
            if (!isInitial) {
                const hasContent = document.getElementById('editor').value.trim();
                const hasAudio = currentAudioData !== null;
                const hasReminder = currentReminder !== null;
                if ((hasContent || hasAudio || hasReminder) && !confirm('Start a new note? Any unsaved changes, voice recordings, and reminders will be lost.')) return;
            }
            
            const now = new Date();
            const defaultFilename = `note-${now.toISOString().slice(0, 16).replace(/[:T]/g, '-')}`;
            
            document.getElementById('filename').value = defaultFilename;
            document.getElementById('editor').value = '';
            document.getElementById('tagInput').value = '';
            document.getElementById('reminderInput').value = '';
            tags = [];
            
            // Clear voice recording
            currentAudioData = null;
            if (audioElement) {
                audioElement.pause();
                audioElement = null;
            }
            const waveform = document.getElementById('recordingWaveform');
            waveform.innerHTML = '';
            
            // Clear reminder
            currentReminder = null;
            localStorage.removeItem('clearviewNotesReminder');
            
            updateTagsDisplay();
            updateDetailedAnalytics();
            updateAudioPlaybackUI();
            updateReminderDisplay();
            updateStats();
            
            if (!isInitial) {
                document.getElementById('editor').focus();
                showSuccess('üìÑ New note started!');
            }
        }

        function loadNote() {
            const hasContent = document.getElementById('editor').value.trim();
            if (hasContent && !confirm('Load a file? This will replace your current note.')) return;
            document.getElementById('fileInput').click();
        }

        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const noteData = JSON.parse(e.target.result);
                    document.getElementById('editor').value = noteData.content || '';
                    tags = noteData.tags || [];
                    document.getElementById('filename').value = file.name.replace(/\.json$/, "");
                    
                    // Load voice recording if it exists
                    if (noteData.voiceRecording) {
                        currentAudioData = noteData.voiceRecording;
                        updateAudioPlaybackUI();
                    } else {
                        currentAudioData = null;
                        updateAudioPlaybackUI();
                    }
                    
                    // Load reminder if it exists and is still future
                    if (noteData.reminder) {
                        const reminderTime = new Date(noteData.reminder.timestamp);
                        const now = new Date();
                        
                        if (reminderTime > now) {
                            currentReminder = noteData.reminder;
                            localStorage.setItem('clearviewNotesReminder', JSON.stringify(currentReminder));
                            updateReminderDisplay();
                            showSuccess(`üìÅ Loaded note with active reminder (${formatReminderDate(reminderTime)})!`);
                        } else {
                            currentReminder = null;
                            updateReminderDisplay();
                            showSuccess(`üìÅ Successfully loaded "${file.name}" (reminder was expired)!`);
                        }
                    } else {
                        currentReminder = null;
                        updateReminderDisplay();
                        showSuccess(`üìÅ Successfully loaded "${file.name}"!`);
                    }
                    
                    // Add loaded tags to history
                    tags.forEach(tag => addToTagHistory(tag));
                    
                    updateTagsDisplay();
                    updateDetailedAnalytics();
                    updateStats();
                } catch (error) {
                    showSuccess('‚ùå Error: Invalid JSON file format.', true);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function handleTagInput(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tagValue = e.target.value.trim();
                if (tagValue && !tags.includes(tagValue)) {
                    tags.push(tagValue);
                    e.target.value = '';
                    addToTagHistory(tagValue);
                    updateTagsDisplay();
                    updateDetailedAnalytics();
                    showSuccess(`üè∑Ô∏è Added tag: "${tagValue}"`);
                } else if (tags.includes(tagValue)) {
                    showSuccess('‚ö†Ô∏è Tag already exists!', true);
                    e.target.value = '';
                }
            }
        }
        
        function removeTag(tagToRemove) {
            tags = tags.filter(tag => tag !== tagToRemove);
            updateTagsDisplay();
            updateDetailedAnalytics();
            showSuccess(`üóëÔ∏è Removed tag: "${tagToRemove}"`);
        }

        function updateTagsDisplay() {
            const tagsContainer = document.getElementById('tags');
            tagsContainer.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagElement.title = 'Click to remove';
                tagElement.addEventListener('click', () => removeTag(tag));
                tagsContainer.appendChild(tagElement);
            });
        }
        
        function updateStats() {
            const content = document.getElementById('editor').value;
            const words = content.trim() ? content.trim().split(/\s+/).length : 0;
            document.getElementById('wordCount').textContent = words;
            document.getElementById('charCount').textContent = content.length;
            document.getElementById('lastModified').textContent = new Date().toLocaleTimeString();
        }
        
        function showSuccess(message, isError = false, duration = 3000) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.className = isError ? 'success-message error' : 'success-message';
            successDiv.style.display = 'block';
            
            setTimeout(() => { 
                successDiv.style.display = 'none'; 
            }, duration);
        }
    </script>
</body>
</html>